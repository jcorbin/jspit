{
  "version": 3,
  "sources": ["/Users/jcorbin/borkshop-js/packages/jspit/src/ui.ts"],
  "sourcesContent": ["export interface Bindings {\n  version: HTMLElement|NodeListOf<HTMLElement>,\n  latest: HTMLElement,\n}\n\nfunction tailPart(s:string):string {\n  const parts = s.split('/');\n  return parts.pop() || parts.pop() || '';\n}\n\ninterface urlParts {\n  hash: string;\n  host: string;\n  hostname: string;\n  href: string;\n  readonly origin: string;\n  pathname: string;\n  port: string;\n  protocol: string;\n  search: string;\n}\n\nfunction parseVersion(doc:Document, url:string|urlParts):string {\n  if (typeof url === 'string') url = new URL(url);\n  const base = doc.querySelector('head base');\n  const version = tailPart(base?.getAttribute('href') || '');\n  if (version && version !== '.') return version;\n  const parts = url.pathname.split('/');\n  return parts[parts.length - 2] || '';\n}\n\nfunction getVersion():string {\n  return parseVersion(document, window.location);\n}\n\nexport async function getLatestVersion():Promise<string> {\n  const parser = new DOMParser();\n  const response = await fetch('/index.html', {cache: 'reload'});\n  const doc = parser.parseFromString(await response.text(), 'text/html');\n  const version = parseVersion(doc, response.url);\n  return version;\n}\n\nexport async function show(bound:Partial<Bindings>, should:boolean, running:boolean) {\n  document.body.classList.toggle('showUI', should);\n  document.body.classList.toggle('running', running);\n  const version = getVersion() || 'DEV';\n  if (bound.version) {\n    if (bound.version instanceof HTMLElement) bound.version.innerText = version;\n    else for (const el of bound.version) el.innerText = version;\n  }\n  if (bound.latest) {\n    const latest = await getLatestVersion();\n    if (latest && latest !== version) {\n      const link = bound.latest.tagName.toLowerCase() === 'a'\n        ? bound.latest as HTMLLinkElement\n        : bound.latest.querySelector('a');\n      if (link) {\n        if (getComputedStyle(bound.latest).display === 'none')\n          bound.latest.style.display = 'initial';\n        link.href = window.location.href.replace(`/${version}/`, `/${latest}/`);\n        link.innerText = latest;\n      }\n    }\n  }\n}\n"],
  "mappings": "AAKA,kBAAkB;AAChB,QAAM,QAAQ,EAAE,MAAM;AACtB,SAAO,MAAM,SAAS,MAAM,SAAS;AAAA;AAevC,sBAAsB,KAAc;AAClC,MAAI,OAAO,QAAQ;AAAU,UAAM,IAAI,IAAI;AAC3C,QAAM,OAAO,IAAI,cAAc;AAC/B,QAAM,UAAU,SAAS,MAAM,aAAa,WAAW;AACvD,MAAI,WAAW,YAAY;AAAK,WAAO;AACvC,QAAM,QAAQ,IAAI,SAAS,MAAM;AACjC,SAAO,MAAM,MAAM,SAAS,MAAM;AAAA;AAGpC;AACE,SAAO,aAAa,UAAU,OAAO;AAAA;AAGvC;AACE,QAAM,SAAS,IAAI;AACnB,QAAM,WAAW,MAAM,MAAM,eAAe,CAAC,OAAO;AACpD,QAAM,MAAM,OAAO,gBAAgB,MAAM,SAAS,QAAQ;AAC1D,QAAM,UAAU,aAAa,KAAK,SAAS;AAC3C,SAAO;AAAA;AAGT,2BAA2B,OAAyB,QAAgB;AAClE,WAAS,KAAK,UAAU,OAAO,UAAU;AACzC,WAAS,KAAK,UAAU,OAAO,WAAW;AAC1C,QAAM,UAAU,gBAAgB;AAChC,MAAI,MAAM;AACR,QAAI,MAAM,mBAAmB;AAAa,YAAM,QAAQ,YAAY;AAAA;AAC/D,iBAAW,MAAM,MAAM;AAAS,WAAG,YAAY;AAAA;AAEtD,MAAI,MAAM;AACR,UAAM,SAAS,MAAM;AACrB,QAAI,UAAU,WAAW;AACvB,YAAM,OAAO,MAAM,OAAO,QAAQ,kBAAkB,MAChD,MAAM,SACN,MAAM,OAAO,cAAc;AAC/B,UAAI;AACF,YAAI,iBAAiB,MAAM,QAAQ,YAAY;AAC7C,gBAAM,OAAO,MAAM,UAAU;AAC/B,aAAK,OAAO,OAAO,SAAS,KAAK,QAAQ,IAAI,YAAY,IAAI;AAC7D,aAAK,YAAY;AAAA;AAAA;AAAA;AAAA;",
  "names": []
}
